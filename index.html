<script>
    async function fetchLeads() {
        const debugDiv = document.getElementById('lead-list');
        try {
            console.log("Fetching from:", SCRIPT_URL);
            const response = await fetch(SCRIPT_URL);
            if (!response.ok) throw new Error('Network response was not ok');
            
            const data = await response.json();
            console.log("Data received:", data);

            allLeads = data.filter(l => 
                l['Agent'] && l['Agent'].toString().trim().toLowerCase() === currentAgent.toLowerCase()
            );
            
            if (allLeads.length === 0) {
                debugDiv.innerHTML = `<p class='text-center p-10'>Connection OK, but no leads found for "${currentAgent}". Check Column C in your Sheet.</p>`;
            } else {
                renderLeads();
            }
        } catch (e) {
            console.error(e);
            debugDiv.innerHTML = `<p class='text-center text-red-500 p-10'>CONNECTION BLOCKED: Make sure your Script is set to 'Anyone' and the URL is correct.</p>`;
        }
    }
</script>
